<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeNote Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        html, body, #root {
            height: 100%;
            width: 100%;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
        }
        
        .app-container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
        }
        
        .app-header {
            background: #2c3e50;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .app-title i {
            color: #4ecdc4;
        }
        
        .app-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .notes-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .note-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
        }
        
        .note-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .note-item.active {
            border-left: 4px solid #4ecdc4;
            background: #edf7f7;
        }
        
        .note-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .note-preview {
            font-size: 13px;
            color: #7f8c8d;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .new-note-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 15px;
            transition: all 0.2s ease;
        }
        
        .new-note-btn:hover {
            background: #3dbcb4;
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .editor-toolbar {
            padding: 15px 20px;
            background: #f1f3f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .language-select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 14px;
            background: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .toolbar-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .save-btn {
            background: #4ecdc4;
            color: white;
        }
        
        .run-btn {
            background: #fdbb2d;
            color: white;
        }
        
        .delete-btn {
            background: #ff6b6b;
            color: white;
        }
        
        .editor-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .code-editor {
            flex: 1;
            border-bottom: 1px solid #e0e0e0;
            overflow: hidden;
        }
        
        .code-textarea {
            width: 100%;
            height: 100%;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            border: none;
            resize: none;
            outline: none;
        }
        
        .notes-section {
            padding: 15px;
            flex-shrink: 0;
        }
        
        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        
        .output-container {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .output-header {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .output-content {
            background: #2c3e50;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #7f8c8d;
            text-align: center;
            padding: 20px;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            background: #4ecdc4;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .notification.error {
            background: #ff6b6b;
        }
        
        @media (max-width: 768px) {
            .app-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- App Component -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_BASE_URL = 'http://localhost:8080/api';
        
        const CodeNoteEditor = () => {
            const [notes, setNotes] = useState([]);
            const [activeNote, setActiveNote] = useState(null);
            const [notification, setNotification] = useState(null);
            const [loading, setLoading] = useState(true);

            // Show notification
            const showNotification = (message, isError = false) => {
                setNotification({ message, isError });
                setTimeout(() => setNotification(null), 3000);
            };

            // Fetch all notes from the backend
            const fetchNotes = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(`${API_BASE_URL}/notes`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch notes');
                    }
                    const data = await response.json();
                    setNotes(data);
                    if (data.length > 0 && !activeNote) {
                        handleNoteSelect(data[0]);
                    }
                } catch (error) {
                    console.error('Error fetching notes:', error);
                    showNotification('Error fetching notes: ' + error.message, true);
                } finally {
                    setLoading(false);
                }
            };

            // Create a new note
            const createNote = async () => {
                try {
                    const newNote = {
                        title: 'New Code Note',
                        language: 'javascript',
                        code: '// Write your code here\nconsole.log("Hello, World!");',
                        notes: 'Add your notes here...',
                        output: ''
                    };
                    
                    const response = await fetch(`${API_BASE_URL}/notes`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(newNote),
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to create note');
                    }
                    
                    const createdNote = await response.json();
                    setNotes([createdNote, ...notes]);
                    handleNoteSelect(createdNote);
                    showNotification('Note created successfully!');
                } catch (error) {
                    console.error('Error creating note:', error);
                    showNotification('Error creating note: ' + error.message, true);
                }
            };

            // Update a note
            const updateNote = async (noteData) => {
                if (!activeNote) return;
                
                try {
                    const response = await fetch(`${API_BASE_URL}/notes/${activeNote.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(noteData),
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to update note');
                    }
                    
                    const savedNote = await response.json();
                    setNotes(notes.map(note => 
                        note.id === activeNote.id ? savedNote : note
                    ));
                    setActiveNote(savedNote);
                    showNotification('Note saved successfully!');
                } catch (error) {
                    console.error('Error updating note:', error);
                    showNotification('Error updating note: ' + error.message, true);
                }
            };

            // Delete a note
            const deleteNote = async () => {
                if (!activeNote) return;
                
                if (window.confirm('Are you sure you want to delete this note?')) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/notes/${activeNote.id}`, {
                            method: 'DELETE',
                        });
                        
                        if (!response.ok) {
                            throw new Error('Failed to delete note');
                        }
                        
                        const updatedNotes = notes.filter(note => note.id !== activeNote.id);
                        setNotes(updatedNotes);
                        
                        if (updatedNotes.length > 0) {
                            handleNoteSelect(updatedNotes[0]);
                        } else {
                            setActiveNote(null);
                        }
                        
                        showNotification('Note deleted successfully!');
                    } catch (error) {
                        console.error('Error deleting note:', error);
                        showNotification('Error deleting note: ' + error.message, true);
                    }
                }
            };

            // Execute code
            const executeCode = async (code, language) => {
                try {
                    // Execute arbitrary code
                    const response = await fetch(`${API_BASE_URL}/notes/execute?code=${encodeURIComponent(code)}&language=${language}`, {
                        method: 'POST',
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to execute code');
                    }
                    
                    const result = await response.text();
                    showNotification('Code executed successfully!');
                    return result;
                } catch (error) {
                    console.error('Error executing code:', error);
                    showNotification('Error executing code: ' + error.message, true);
                    return 'Error: ' + error.message;
                }
            };

            // Handle note selection
            const handleNoteSelect = (note) => {
                setActiveNote(note);
            };

            // Load notes on component mount
            useEffect(() => {
                fetchNotes();
            }, []);

            return (
                <div className="app-container">
                    <header className="app-header">
                        <div className="app-title">
                            <i className="fas fa-code"></i>
                            <span>CodeNote Editor</span>
                        </div>
                        <div>
                            <i className="fas fa-database"></i>
                            <span> MongoDB</span>
                        </div>
                    </header>
                    
                    <div className="app-content">
                        <Sidebar 
                            notes={notes}
                            activeNote={activeNote}
                            onNoteSelect={handleNoteSelect}
                            onCreateNote={createNote}
                            loading={loading}
                        />
                        
                        <Editor 
                            activeNote={activeNote}
                            onUpdateNote={updateNote}
                            onDeleteNote={deleteNote}
                            onExecuteCode={executeCode}
                        />
                    </div>
                    
                    {notification && (
                        <Notification 
                            message={notification.message}
                            isError={notification.isError}
                        />
                    )}
                </div>
            );
        };

        // Sidebar Component
        const Sidebar = ({ notes, activeNote, onNoteSelect, onCreateNote, loading }) => {
            return (
                <div className="sidebar">
                    <div className="sidebar-header">
                        <h3>Your Code Notes</h3>
                    </div>
                    <div className="notes-list">
                        {loading ? (
                            <div className="empty-state">
                                <i className="fas fa-spinner fa-spin"></i>
                                <p>Loading notes...</p>
                            </div>
                        ) : notes.length === 0 ? (
                            <div className="empty-state">
                                <i className="fas fa-sticky-note"></i>
                                <p>No notes yet</p>
                            </div>
                        ) : (
                            notes.map(note => (
                                <NoteItem 
                                    key={note.id} 
                                    note={note}
                                    isActive={activeNote && activeNote.id === note.id}
                                    onSelect={onNoteSelect}
                                />
                            ))
                        )}
                    </div>
                    <button className="new-note-btn" onClick={onCreateNote}>
                        <i className="fas fa-plus"></i>
                        New Note
                    </button>
                </div>
            );
        };

        // Note Item Component
        const NoteItem = ({ note, isActive, onSelect }) => {
            return (
                <div 
                    className={`note-item ${isActive ? 'active' : ''}`}
                    onClick={() => onSelect(note)}
                >
                    <div className="note-title">{note.title}</div>
                    <div className="note-preview">{note.language.toUpperCase()}: {note.code.substring(0, 50)}...</div>
                </div>
            );
        };

        // Editor Component
        const Editor = ({ activeNote, onUpdateNote, onDeleteNote, onExecuteCode }) => {
            const [language, setLanguage] = useState('javascript');
            const [code, setCode] = useState('');
            const [noteText, setNoteText] = useState('');
            const [output, setOutput] = useState('');
            const [title, setTitle] = useState('');

            // Update local state when active note changes
            useEffect(() => {
                if (activeNote) {
                    setLanguage(activeNote.language);
                    setCode(activeNote.code);
                    setNoteText(activeNote.notes);
                    setOutput(activeNote.output || '');
                    setTitle(activeNote.title);
                } else {
                    setLanguage('javascript');
                    setCode('');
                    setNoteText('');
                    setOutput('');
                    setTitle('');
                }
            }, [activeNote]);

            const handleSave = () => {
                if (!activeNote) return;
                onUpdateNote({
                    title,
                    language,
                    code,
                    notes: noteText,
                    output
                });
            };

            const handleRun = async () => {
                const result = await onExecuteCode(code, language);
                setOutput(result);
                
                // If we have an active note, update it with the output
                if (activeNote) {
                    onUpdateNote({
                        title,
                        language,
                        code,
                        notes: noteText,
                        output: result
                    });
                }
            };

            if (!activeNote) {
                return (
                    <div className="editor-container">
                        <div className="empty-state">
                            <i className="fas fa-code"></i>
                            <h3>No Note Selected</h3>
                            <p>Select a note from the sidebar or create a new one to start coding.</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="editor-container">
                    <div className="editor-toolbar">
                        <input 
                            type="text" 
                            value={title} 
                            onChange={(e) => setTitle(e.target.value)}
                            placeholder="Note title"
                            style={{ padding: '8px 12px', borderRadius: '6px', border: '1px solid #ddd', width: '300px' }}
                        />
                        <div className="action-buttons">
                            <select 
                                className="language-select" 
                                value={language} 
                                onChange={(e) => setLanguage(e.target.value)}
                            >
                                <option value="javascript">JavaScript</option>
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="cpp">C++</option>
                                <option value="html">HTML</option>
                                <option value="css">CSS</option>
                            </select>
                            <button className="toolbar-btn save-btn" onClick={handleSave}>
                                <i className="fas fa-save"></i>
                                Save
                            </button>
                            <button className="toolbar-btn run-btn" onClick={handleRun}>
                                <i className="fas fa-play"></i>
                                Run
                            </button>
                            <button className="toolbar-btn delete-btn" onClick={onDeleteNote}>
                                <i className="fas fa-trash"></i>
                                Delete
                            </button>
                        </div>
                    </div>
                    
                    <div className="editor-content">
                        <div className="code-editor">
                            <textarea 
                                className="code-textarea"
                                value={code} 
                                onChange={(e) => setCode(e.target.value)}
                                spellCheck="false"
                            />
                        </div>
                        
                        <div className="notes-section">
                            <textarea 
                                className="notes-textarea"
                                value={noteText} 
                                onChange={(e) => setNoteText(e.target.value)}
                                placeholder="Add your notes about the code here..."
                            />
                        </div>
                    </div>
                    
                    <div className="output-container">
                        <div className="output-header">
                            <i className="fas fa-terminal"></i>
                            Output
                        </div>
                        <div className="output-content">
                            {output}
                        </div>
                    </div>
                </div>
            );
        };

        // Notification Component
        const Notification = ({ message, isError }) => {
            return (
                <div className={`notification ${isError ? 'error' : ''}`}>
                    <i className={`fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'}`}></i>
                    {message}
                </div>
            );
        };

        ReactDOM.render(<CodeNoteEditor />, document.getElementById('root'));
    </script>
</body>
</html>